<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Secret Santa Letter</title>
  <style>
    :root{
      --bg1:#fff5f5;
      --bg2:#ffe8e8;
      --panel: rgba(220,38,38,.08);
      --border: rgba(220,38,38,.20);
      --paper:#ffffff;
      --ink:#1f1f1f;
      --accent:#dc2626;
      --accent2:#b91c1c;
      --shadow: 0 24px 70px rgba(220,38,38,.25);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:#1f1f1f;
      background:
        radial-gradient(1000px 600px at 15% 20%, rgba(220,38,38,.15), transparent 60%),
        radial-gradient(900px 520px at 85% 70%, rgba(185,28,28,.12), transparent 62%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    #snowCanvas{
      position:fixed;
      inset:0;
      z-index:0;
      pointer-events:none;
    }
    .trail{
      position:fixed;
      width:14px;
      height:14px;
      z-index:1;
      pointer-events:none;
      opacity:0.95;
      transform: translate(-50%, -50%);
      filter: drop-shadow(0 8px 10px rgba(220,38,38,.3));
      animation: trailFade .8s ease forwards;
    }
    @keyframes trailFade{
      to { opacity:0; transform: translate(-50%, -80%) scale(.5); }
    }

    /* ============ LANDING PAGE ============ */
    .landing{
      position:fixed;
      inset:0;
      z-index:100;
      display:grid;
      place-items:center;
      background:
        radial-gradient(1000px 600px at 15% 20%, rgba(220,38,38,.15), transparent 60%),
        radial-gradient(900px 520px at 85% 70%, rgba(185,28,28,.12), transparent 62%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      opacity:1;
      transition: opacity .6s ease, visibility .6s ease;
    }

    .landing.hidden{
      opacity:0;
      visibility:hidden;
      pointer-events:none;
    }

    .landing-content{
      text-align:center;
      padding:20px;
      animation: fadeInUp 1s ease-out;
    }

    @keyframes fadeInUp{
      from{
        opacity:0;
        transform:translateY(30px);
      }
      to{
        opacity:1;
        transform:translateY(0);
      }
    }

    .landing-title{
      font-size:3rem;
      font-weight:900;
      color:var(--accent);
      margin:0 0 20px 0;
      text-shadow: 2px 2px 8px rgba(220,38,38,.2);
      animation: fadeInUp 1s ease-out .2s backwards;
    }

    .landing-subtitle{
      font-size:1.3rem;
      color:#666;
      margin:0 0 40px 0;
      animation: fadeInUp 1s ease-out .4s backwards;
    }

    .landing-gift{
      font-size:80px;
      margin-bottom:30px;
      animation: bounce 2s ease-in-out infinite, fadeInUp 1s ease-out .1s backwards;
    }

    @keyframes bounce{
      0%, 100%{ transform: translateY(0) rotate(-5deg); }
      50%{ transform: translateY(-20px) rotate(5deg); }
    }

    .enter-btn{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color:white;
      border:none;
      padding:18px 50px;
      font-size:1.2rem;
      font-weight:700;
      border-radius:50px;
      cursor:pointer;
      box-shadow: 0 20px 40px rgba(220,38,38,.3);
      transition: all .3s ease;
      animation: fadeInUp 1s ease-out .6s backwards, pulse 2s ease-in-out 2s infinite;
    }

    .enter-btn:hover{
      transform: translateY(-3px) scale(1.05);
      box-shadow: 0 25px 50px rgba(220,38,38,.4);
    }

    @keyframes pulse{
      0%, 100%{ box-shadow: 0 20px 40px rgba(220,38,38,.3); }
      50%{ box-shadow: 0 20px 50px rgba(220,38,38,.5); }
    }

    @media (max-width: 600px){
      .landing-title{
        font-size:2rem;
      }
      .landing-subtitle{
        font-size:1rem;
      }
      .landing-gift{
        font-size:60px;
      }
      .enter-btn{
        padding:15px 40px;
        font-size:1rem;
      }
    }

    /* ============ MAIN CONTENT ============ */
    .wrap{
      position:relative;
      z-index:2;
      width:min(980px, 94vw);
      display:grid;
      gap:16px;
      padding:18px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
    }

    .badge{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:10px 14px;
      border-radius:999px;
      background: rgba(255,255,255,.7);
      border: 2px solid var(--accent);
      backdrop-filter: blur(10px);
      box-shadow: 0 10px 30px rgba(220,38,38,.15);
      font-size:14px;
      font-weight:700;
      color: var(--accent);
      user-select:none;
    }
    .dot{
      width:10px;height:10px;border-radius:999px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      box-shadow: 0 0 0 4px rgba(220,38,38,.15);
    }

    .controls{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    button{
      cursor:pointer;
      border:2px solid var(--accent);
      color:var(--accent);
      background: rgba(255,255,255,.7);
      backdrop-filter: blur(8px);
      padding:10px 12px;
      border-radius:12px;
      font-weight:700;
      transition: transform .12s ease, background .12s ease, border-color .12s ease;
    }
    button:hover{ 
      transform: translateY(-1px); 
      background: rgba(255,255,255,.85);
      border-color: var(--accent2);
    }
    button.primary{
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      border:none;
      color: white;
      box-shadow: 0 14px 30px rgba(220,38,38,.25);
    }
    button.primary:hover{
      background: linear-gradient(135deg, var(--accent2), #991b1b);
    }

    .stage{
      border-radius:24px;
      background: rgba(255,255,255,.6);
      backdrop-filter: blur(12px);
      border: 2px solid rgba(220,38,38,.2);
      box-shadow: var(--shadow);
      overflow:hidden;
      padding:22px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:18px;
      align-items:start;
    }
    @media (max-width: 880px){
      .grid{ grid-template-columns:1fr; }
    }

    .envelope-area{
      position:relative;
      min-height: 520px;
      display:grid;
      place-items:center;
      padding:20px 10px;
    }

    .decorations{
      position:absolute;
      inset:0;
      pointer-events:none;
      overflow:hidden;
    }

    .deco-gift{
      position:absolute;
      font-size:40px;
      opacity:0.15;
      animation:float 6s ease-in-out infinite;
    }

    .deco-gift:nth-child(1){
      top:10%;
      left:8%;
      animation-delay:0s;
    }
    .deco-gift:nth-child(2){
      top:25%;
      right:12%;
      animation-delay:1s;
    }
    .deco-gift:nth-child(3){
      bottom:15%;
      left:15%;
      animation-delay:2s;
      font-size:35px;
    }
    .deco-gift:nth-child(4){
      bottom:20%;
      right:10%;
      animation-delay:1.5s;
      font-size:45px;
    }
    .deco-gift:nth-child(5){
      top:50%;
      left:5%;
      animation-delay:0.5s;
      font-size:30px;
    }
    .deco-gift:nth-child(6){
      top:60%;
      right:8%;
      animation-delay:2.5s;
      font-size:38px;
    }

    @keyframes float{
      0%, 100%{ transform: translateY(0) rotate(0deg); }
      25%{ transform: translateY(-10px) rotate(2deg); }
      50%{ transform: translateY(-5px) rotate(-2deg); }
      75%{ transform: translateY(-15px) rotate(1deg); }
    }

    .envelopeWrap{
      position:relative;
      width: 420px;
      height: 300px;
      max-width: 92vw;
      transform: translateY(6px);
    }

    .envelope{
      position:absolute;
      left:50%; top:58%;
      transform: translate(-50%, -50%);
      width: 380px;
      height: 240px;
      max-width: 92vw;
      border-radius:18px;
      background: linear-gradient(135deg, #fee2e2, #fecaca);
      border: 2px solid var(--accent);
      box-shadow: 0 18px 40px rgba(220,38,38,.2);
      overflow:hidden;
    }

    .envelope::after{
      content:"";
      position:absolute; left:0; right:0; bottom:-1px;
      height: 75%;
      background: linear-gradient(135deg, #fecaca, #fee2e2);
      clip-path: polygon(0 100%, 50% 48%, 100% 100%, 100% 0, 0 0);
      border-top: 2px solid rgba(220,38,38,.3);
    }

    .flap{
      position:absolute;
      left:0; right:0; top:-1px;
      height: 62%;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      clip-path: polygon(0 0, 100% 0, 50% 88%);
      transform-origin: top center;
      transform: rotateX(0deg);
      transition: transform .75s cubic-bezier(.2,.95,.2,1);
      border-top-left-radius:18px;
      border-top-right-radius:18px;
      z-index:3;
    }

    .seal{
      position:absolute;
      left:50%; top:60%;
      transform:translate(-50%,-50%);
      width:54px;height:54px;border-radius:999px;
      background: white;
      border: 3px solid var(--accent);
      box-shadow: 0 16px 30px rgba(220,38,38,.3);
      display:grid;
      place-items:center;
      font-size:22px;
      color: var(--accent);
      user-select:none;
      z-index:4;
    }

    .letterCard{
      position:absolute;
      left:50%;
      top:58%;
      transform: translate(-50%, -30px) scale(.98);
      width: 360px;
      max-width: 92vw;
      background: rgba(255,255,255,.85);
      backdrop-filter: blur(12px);
      color: var(--ink);
      border-radius:16px;
      box-shadow: 0 26px 70px rgba(220,38,38,.35);
      border: 2px solid var(--accent);
      padding:14px 14px 12px 14px;
      opacity:0;
      z-index:2;
      clip-path: inset(48% 0 0 0 round 16px);
      transition:
        opacity .35s ease,
        transform .95s cubic-bezier(.12,.95,.18,1),
        clip-path .95s cubic-bezier(.12,.95,.18,1);
    }

    .letterCard .header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:8px;
    }
    .stamp{
      width:60px;height:42px;border-radius:10px;
      background: linear-gradient(135deg, rgba(220,38,38,.15), rgba(185,28,28,.12));
      border: 1px dashed var(--accent);
      display:grid;
      place-items:center;
      font-weight:900;
      letter-spacing:.5px;
      font-size:13px;
      color: var(--accent);
    }
    .toLine{ font-weight:900; font-size:14px; color: var(--accent); }

    .preview{
      font-size:14.5px;
      line-height:1.45;
      white-space:pre-wrap;
      min-height:118px;
    }
    .sig{
      margin-top:10px;
      font-weight:900;
      color: var(--accent);
    }
    .miniHint{
      margin-top:8px;
      font-size:12.5px;
      color: #666;
    }

    .open .flap{ transform: rotateX(165deg); }

    .open .letterCard{
      opacity:1;
      transform: translate(-50%, -210px) scale(1);
      clip-path: inset(0 0 0 0 round 16px);
    }

    .panel{
      background: rgba(255,255,255,.65);
      backdrop-filter: blur(10px);
      border: 2px solid rgba(220,38,38,.25);
      border-radius:18px;
      padding:14px;
      box-shadow: 0 16px 44px rgba(220,38,38,.15);
    }
    .panel h3{
      margin:0 0 8px 0;
      font-size:16px;
      letter-spacing:.2px;
      color: var(--accent);
      background: rgba(255,255,255,.4);
      backdrop-filter: blur(8px);
      padding: 8px 12px;
      border-radius: 10px;
      border: 1px solid rgba(220,38,38,.15);
    }
    .panel p{
      margin:0 0 10px 0;
      line-height:1.45;
      font-size:14px;
      color: #333;
    }

    .hintBox{
      display:flex;
      gap:10px;
      align-items:flex-start;
      flex-wrap:wrap;
    }
    .hintText{
      flex:1;
      min-width: 220px;
      background: rgba(254,242,242,.8);
      backdrop-filter: blur(8px);
      border: 2px solid rgba(220,38,38,.2);
      border-radius:14px;
      padding:10px 12px;
      font-size:14px;
      line-height:1.45;
      color: #333;
    }

    .videoWrap{
      border-radius:14px;
      overflow:hidden;
      border: 2px solid rgba(220,38,38,.2);
      background: rgba(254,242,242,.7);
      backdrop-filter: blur(8px);
      display: flex;
      justify-content: center;
      align-items: center;
    }
    iframe{
      width:100%;
      aspect-ratio:16/9;
      border:0;
      display:block;
    }
    video{
      width:100%;
      max-width: 400px;
      aspect-ratio: 9/16;
      display:block;
      border-radius: 14px;
    }
    @media (max-width: 880px){
      video{
        max-width: 100%;
      }
    }
    .smallNote{ font-size:12.5px; color: #666; }

    .modal{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      padding:16px;
      background: rgba(0,0,0,.6);
      backdrop-filter: blur(10px);
      z-index:50;
    }
    .modal.show{ display:grid; }

    .paper{
      width:min(820px, 96vw);
      background: rgba(255,255,255,.95);
      backdrop-filter: blur(12px);
      color:var(--ink);
      border-radius:22px;
      box-shadow: 0 34px 100px rgba(220,38,38,.5);
      border: 2px solid var(--accent);
      overflow:hidden;
    }
    .paperTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:12px 14px;
      background: rgba(254,242,242,.9);
      backdrop-filter: blur(8px);
      border-bottom: 2px solid rgba(220,38,38,.2);
    }
    .paperTop .title{
      font-weight:1000;
      letter-spacing:.2px;
      color: var(--accent);
    }
    .paperBody{
      padding:16px;
      font-size:16px;
      line-height:1.65;
      white-space:pre-wrap;
    }

    .scratchBox{
      margin-top:12px;
      border-radius:14px;
      overflow:hidden;
      border:2px solid rgba(220,38,38,.2);
      background: rgba(254,242,242,.7);
      backdrop-filter: blur(8px);
      position:relative;
    }
    .scratchInner{
      padding:12px 12px 10px 12px;
    }
    .secretLine{
      font-weight:900;
      font-size:14px;
      letter-spacing:.2px;
      padding:10px 12px;
      border-radius:12px;
      background: linear-gradient(135deg, rgba(220,38,38,.15), rgba(185,28,28,.12));
      border: 2px solid rgba(220,38,38,.3);
      color: var(--accent);
    }
    .scratchCanvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      touch-action:none;
      cursor: crosshair;
    }
    .scratchLabel{
      margin:0 0 8px 0;
      font-size:13px;
      color: #333;
    }

    .footerTip{
      margin-top:10px;
      text-align:center;
      font-size:12.5px;
      color: #666;
    }

    .musicControl{
      position:fixed;
      bottom:20px;
      right:20px;
      z-index:100;
      background: rgba(255,255,255,.75);
      backdrop-filter: blur(12px);
      border: 2px solid var(--accent);
      border-radius:50px;
      padding:12px 16px;
      display:flex;
      align-items:center;
      gap:10px;
      box-shadow: 0 10px 30px rgba(220,38,38,.2);
      cursor:pointer;
      transition: all .2s ease;
      user-select:none;
    }
    .musicControl:hover{
      transform: translateY(-2px);
      box-shadow: 0 12px 35px rgba(220,38,38,.3);
      background: rgba(255,255,255,.9);
    }
    .musicControl:active{
      transform: translateY(0);
    }
    .musicIcon{
      font-size:18px;
      line-height:1;
    }
    .musicLabel{
      font-size:13px;
      font-weight:700;
      letter-spacing:.3px;
      color: var(--accent);
    }
    .musicControl.playing .musicIcon{
      animation: musicPulse 1.5s ease-in-out infinite;
    }
    @keyframes musicPulse{
      0%, 100% { opacity: 1; transform: scale(1); }
      50% { opacity: 0.7; transform: scale(1.1); }
    }

    #musicPlayer{
      position:absolute;
      opacity:0;
      pointer-events:none;
    }

    @media (max-width: 880px){
      .wrap{
        padding:12px;
        width: 96vw;
      }
      .topbar{
        flex-direction: column;
        align-items: stretch;
      }
      .controls{
        justify-content: stretch;
      }
      .controls button{
        flex: 1;
      }
      .stage{
        padding: 16px;
      }
      .envelope-area{
        min-height: 440px;
      }
      .envelopeWrap{
        width: 100%;
        height: 280px;
      }
      .envelope{
        width: min(340px, 90vw);
        height: 220px;
      }
      .letterCard{
        width: min(320px, 88vw);
        padding: 12px;
      }
      .open .letterCard{
        transform: translate(-50%, -180px) scale(1);
      }
      .preview{
        font-size: 13.5px;
        min-height: 100px;
      }
      .panel{
        padding: 12px;
      }
      .panel h3{
        font-size: 15px;
      }
      .panel p{
        font-size: 13px;
      }
      .hintText{
        min-width: 100%;
        font-size: 13px;
      }
      .musicControl{
        bottom: 12px;
        right: 12px;
        padding: 10px 14px;
        font-size: 12px;
      }
      .musicIcon{
        font-size: 16px;
      }
      .musicLabel{
        font-size: 12px;
      }
      .modal{
        padding: 12px;
      }
      .paperBody{
        padding: 14px;
        font-size: 14.5px;
      }
      .badge{
        font-size: 13px;
        padding: 8px 12px;
      }
      .footerTip{
        font-size: 11.5px;
      }
    }

    @media (max-width: 480px){
      .envelope{
        width: min(300px, 88vw);
        height: 200px;
      }
      .letterCard{
        width: min(280px, 85vw);
      }
      .open .letterCard{
        transform: translate(-50%, -160px) scale(1);
      }
      button{
        font-size: 14px;
        padding: 10px 16px;
      }
    }
  </style>
</head>

<body>
  <canvas id="snowCanvas"></canvas>

  <!-- Landing Page -->
  <div class="landing" id="landingPage">
    <div class="landing-content">
      <div class="landing-gift">üéÅ</div>
      <h1 class="landing-title">You've Got Mail!</h1>
      <p class="landing-subtitle">Someone special sent you a Secret Santa letter üéÑ</p>
      <button class="enter-btn" id="enterBtn">Open Your Gift ‚ú®</button>
    </div>
  </div>

  <!-- Music Control -->
  <div class="musicControl" id="musicControl" style="display:none;">
    <div class="musicIcon">üéµ</div>
    <div class="musicLabel">Play Music</div>
  </div>

  <!-- Hidden music player -->
  <div id="musicPlayer"></div>

  <div class="wrap">
    <div class="topbar">
      <div class="badge"><span class="dot"></span> Secret Santa Letter</div>
      <div class="controls">
        <button id="guessBtn">Guess who I am üïµÔ∏è</button>
        <button id="openBtn" class="primary">Open the Letter ‚úâÔ∏è</button>
      </div>
    </div>

    <div class="stage">
      <div class="grid">
        <div class="envelope-area" id="envelopeArea">
          <div class="decorations">
            <div class="deco-gift">üéÅ</div>
            <div class="deco-gift">üéÑ</div>
            <div class="deco-gift">‚≠ê</div>
            <div class="deco-gift">üéÖ</div>
            <div class="deco-gift">‚ùÑÔ∏è</div>
            <div class="deco-gift">üîî</div>
          </div>

          <div class="envelopeWrap">
            <div class="letterCard" id="letterCard" aria-hidden="true">
              <div class="header">
                <div class="toLine" id="toLine">To: Bablu</div>
                <div class="stamp">SANTA</div>
              </div>
              <div class="preview" id="typedPreview"></div>
              <div class="sig" id="sigLine">‚Äî from your Secret Santa</div>
              <div class="miniHint">Click the letter to open it fully üíå</div>
            </div>

            <div class="envelope">
              <div class="flap" id="flap"></div>
              <div class="seal">‚òÖ</div>
            </div>
          </div>

          <div class="footerTip">Love from bottom of my hearts üòâ</div>
        </div>

        <div style="display:grid; gap:14px;">
          <div class="panel">
            <h3>Clues üïµÔ∏è</h3>
            <p>Click <b>"Guess who I am"</b> to reveal 1 hint at a time (max 3).</p>
            <div class="hintBox">
              <div class="hintText" id="hintText">No hints yet üëÄ</div>
            </div>
          </div>

          <div class="panel">
            <h3>Video for you üé•</h3>
            <p>A special message just for you.</p>

            <div class="videoWrap" id="videoWrap"></div>

            <p class="smallNote" style="margin-top:10px;">
              Enjoy this little surprise üíù
            </p>
          </div>

          <div class="panel">
            <h3>Secret line ‚ú®</h3>
            <p class="scratchLabel">Scratch the card to reveal a hidden message</p>

            <div class="scratchBox" id="scratchBox">
              <div class="scratchInner">
                <div class="secretLine" id="secretLine"></div>
              </div>
              <canvas class="scratchCanvas" id="scratchCanvas"></canvas>
            </div>

            <p class="smallNote" style="margin-top:10px;">
              Use your finger or mouse to scratch away the cover üéÅ
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal" id="modal" role="dialog" aria-modal="true">
    <div class="paper">
      <div class="paperTop">
        <div class="title">A letter for you üíå</div>
        <button id="closeModal">Close</button>
      </div>
      <div class="paperBody" id="fullLetter"></div>
    </div>
  </div>

  <script>
    const CONFIG = {
      recipientName: "Bablu",

      letter: `Dear Bablu,

As the year winds down, I've been reflecting on the time we've shared. Our friendship, much like the snow, can feel cold at times. It's been one of those things that's quietly settled, sometimes distant, but always there. And though we may not always be in the same space, our bond is like snowflakes falling softly, finding their way back to each other when the warmth of time allows it.

The passage of time is like this. The years may pass, but the moments we share, the laughs and the quiet exchanges, they have a way of coming back around. It's a comforting thought, don't you think? That no matter what, the connection we have will always melt the cold and return in different ways. We don't always notice it happening, but it's always there, silently building back up, just like snow.

So, as the year closes, I wanted to remind you that our friendship though it may come and go like the seasons is something I truly value. No matter how far apart we may be, I know the warmth of it will return when the time is right.

Here's to the cold moments, when it returns, and everything in between. This is not a Christmas holiday greeting, but a simple note to remind you that as the year closes, I'm grateful for everything we've shared and all the things yet to come. So dont judge

Take care,
Your Secret Santa üéÅ`,

      signature: "‚Äî from your Secret Santa",

      hints: [
        "Hint 1: So close to you",
        "Hint 2: U ACT LIKE HE IS A GIRL SOMETIMES",
        "Hint 3: He means so much to you"
      ],

      secretLine: "Secret: You deserve way more appreciation than you get. ü§ç",

      video: { type: "local", src: "video.mp4" },

      music: {
        enabled: true,
        type: "audio",
        youtubeId: "",
        audioSrc: "music.mp3",
        autoplay: true,
        volume: 0.3
      },

      cursorTrail: { enabled: true, style: "mix" },

      snow: { enabled: true, density: 120 }
    };

    // Landing Page
    const landingPage = document.getElementById("landingPage");
    const enterBtn = document.getElementById("enterBtn");

    enterBtn.addEventListener("click", () => {
      landingPage.classList.add("hidden");
    });

    function typewriter(el, text, speed = 14) {
      el.textContent = "";
      let i = 0;
      return new Promise(resolve => {
        const t = setInterval(() => {
          el.textContent += text[i] ?? "";
          i++;
          if (i >= text.length) { clearInterval(t); resolve(); }
        }, speed);
      });
    }

    const envelopeArea = document.getElementById("envelopeArea");
    const openBtn = document.getElementById("openBtn");
    const letterCard = document.getElementById("letterCard");
    const typedPreview = document.getElementById("typedPreview");
    const toLine = document.getElementById("toLine");
    const sigLine = document.getElementById("sigLine");

    const modal = document.getElementById("modal");
    const closeModal = document.getElementById("closeModal");
    const fullLetter = document.getElementById("fullLetter");

    toLine.textContent = `To: ${CONFIG.recipientName}`;
    sigLine.textContent = CONFIG.signature;
    fullLetter.textContent = CONFIG.letter;

    let opened = false;

    openBtn.addEventListener("click", async () => {
      if (opened) return;
      opened = true;

      envelopeArea.classList.add("open");
      letterCard.setAttribute("aria-hidden", "false");

      const trimmed = CONFIG.letter.trim();
      const preview = trimmed.slice(0, 320) + (trimmed.length > 320 ? "‚Ä¶" : "");
      await typewriter(typedPreview, preview, 12);
    });

    letterCard.addEventListener("click", () => {
      if (!opened) return;
      modal.classList.add("show");
    });

    closeModal.addEventListener("click", () => modal.classList.remove("show"));
    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("show");
    });

    const guessBtn = document.getElementById("guessBtn");
    const hintText = document.getElementById("hintText");
    let hintIndex = 0;

    guessBtn.addEventListener("click", () => {
      if (hintIndex >= CONFIG.hints.length) {
        hintText.textContent = "That's all the hints üòå";
        return;
      }
      hintText.textContent = CONFIG.hints[hintIndex];
      hintIndex++;
    });

    const videoWrap = document.getElementById("videoWrap");
    function renderVideo(){
      const v = CONFIG.video;
      videoWrap.innerHTML = "";
      if (!v) return;

      if (v.type === "youtube" && v.id){
        const iframe = document.createElement("iframe");
        iframe.allow =
          "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share";
        iframe.allowFullscreen = true;
        iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(v.id)}?rel=0&modestbranding=1`;
        videoWrap.appendChild(iframe);
      } else if (v.type === "local" && v.src){
        const vid = document.createElement("video");
        vid.controls = true;
        vid.src = v.src;
        videoWrap.appendChild(vid);
      } else {
        videoWrap.innerHTML = "<div style='padding:14px; opacity:.85;'>Video not configured.</div>";
      }
    }
    renderVideo();

    const secretLine = document.getElementById("secretLine");
    secretLine.textContent = CONFIG.secretLine;

    const scratchCanvas = document.getElementById("scratchCanvas");
    const scratchBox = document.getElementById("scratchBox");
    const sctx = scratchCanvas.getContext("2d");

    function resizeScratch(){
      const rect = scratchBox.getBoundingClientRect();
      scratchCanvas.width = Math.floor(rect.width);
      scratchCanvas.height = Math.floor(rect.height);

      sctx.globalCompositeOperation = "source-over";
      sctx.fillStyle = "rgba(220, 38, 38, 0.85)";
      sctx.fillRect(0,0,scratchCanvas.width,scratchCanvas.height);

      sctx.fillStyle = "rgba(255,255,255,0.15)";
      for (let i=0; i<180; i++){
        const x = Math.random() * scratchCanvas.width;
        const y = Math.random() * scratchCanvas.height;
        const w = 20 + Math.random()*50;
        sctx.fillRect(x,y,w,2);
      }

      sctx.fillStyle = "rgba(255,255,255,0.95)";
      sctx.font = "700 14px ui-sans-serif, system-ui";
      sctx.fillText("Scratch here ‚Üí", 14, 28);
    }

    function scratchAt(x, y){
      sctx.globalCompositeOperation = "destination-out";
      sctx.beginPath();
      sctx.arc(x, y, 18, 0, Math.PI*2);
      sctx.fill();
      sctx.globalCompositeOperation = "source-over";
    }

    function getRevealPercent(){
      const img = sctx.getImageData(0,0,scratchCanvas.width,scratchCanvas.height).data;
      let transparent = 0;
      for (let i=3; i<img.length; i+=4){
        if (img[i] === 0) transparent++;
      }
      return transparent / (img.length/4);
    }

    let scratching = false;

    function pointerPos(e){
      const rect = scratchCanvas.getBoundingClientRect();
      const x = (e.clientX ?? e.touches?.[0]?.clientX) - rect.left;
      const y = (e.clientY ?? e.touches?.[0]?.clientY) - rect.top;
      return { x, y };
    }

    scratchCanvas.addEventListener("pointerdown", (e)=>{
      scratching = true;
      const {x,y} = pointerPos(e);
      scratchAt(x,y);
    });
    window.addEventListener("pointerup", ()=>{
      if (!scratching) return;
      scratching = false;

      const pct = getRevealPercent();
      if (pct > 0.55){
        sctx.clearRect(0,0,scratchCanvas.width,scratchCanvas.height);
      }
    });
    scratchCanvas.addEventListener("pointermove", (e)=>{
      if (!scratching) return;
      const {x,y} = pointerPos(e);
      scratchAt(x,y);
    });

    window.addEventListener("resize", resizeScratch);
    resizeScratch();

    const snowCanvas = document.getElementById("snowCanvas");
    const nctx = snowCanvas.getContext("2d");
    let snowflakes = [];

    function resizeSnow(){
      snowCanvas.width = window.innerWidth;
      snowCanvas.height = window.innerHeight;
    }

    function initSnow(){
      snowflakes = [];
      const count = Math.max(40, Math.min(260, CONFIG.snow.density || 120));
      for (let i=0; i<count; i++){
        snowflakes.push({
          x: Math.random()*snowCanvas.width,
          y: Math.random()*snowCanvas.height,
          r: 0.8 + Math.random()*2.8,
          vx: -0.35 + Math.random()*0.7,
          vy: 0.6 + Math.random()*1.8,
          a: 0.15 + Math.random()*0.55
        });
      }
    }

    function snowLoop(){
      if (!CONFIG.snow.enabled) return;
      nctx.clearRect(0,0,snowCanvas.width,snowCanvas.height);
      nctx.beginPath();
      for (const f of snowflakes){
        nctx.moveTo(f.x, f.y);
        nctx.arc(f.x, f.y, f.r, 0, Math.PI*2);
      }
      nctx.fillStyle = "rgba(220,38,38,0.3)";
      nctx.fill();

      for (const f of snowflakes){
        f.x += f.vx;
        f.y += f.vy;

        f.vx += (-0.02 + Math.random()*0.04) * 0.02;

        if (f.y > snowCanvas.height + 10){
          f.y = -10;
          f.x = Math.random()*snowCanvas.width;
        }
        if (f.x < -10) f.x = snowCanvas.width + 10;
        if (f.x > snowCanvas.width + 10) f.x = -10;
      }

      requestAnimationFrame(snowLoop);
    }

    resizeSnow();
    if (CONFIG.snow.enabled){
      initSnow();
      snowLoop();
      window.addEventListener("resize", ()=>{
        resizeSnow();
        initSnow();
      });
    }

    function makeTrail(x, y){
      if (!CONFIG.cursorTrail.enabled) return;

      const el = document.createElement("div");
      el.className = "trail";
      el.style.left = x + "px";
      el.style.top = y + "px";

      const pick = CONFIG.cursorTrail.style;
      let shape = "‚òÖ";
      if (pick === "hearts") shape = "‚ù§";
      if (pick === "stars") shape = "‚òÖ";
      if (pick === "mix") shape = Math.random() < 0.5 ? "‚ù§" : "‚òÖ";

      el.textContent = shape;
      el.style.fontSize = (12 + Math.random()*10) + "px";
      el.style.color = `hsl(${Math.random()*20 + 350}, 85%, 55%)`;

      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 900);
    }

    let lastTrail = 0;
    window.addEventListener("pointermove", (e)=>{
      const now = performance.now();
      if (now - lastTrail < 18) return;
      lastTrail = now;
      makeTrail(e.clientX, e.clientY);
    });

    const musicControl = document.getElementById("musicControl");
    const musicPlayer = document.getElementById("musicPlayer");
    const musicIcon = musicControl.querySelector(".musicIcon");
    const musicLabel = musicControl.querySelector(".musicLabel");
    let isPlaying = false;
    let audioElement = null;

    function initMusic(){
      const m = CONFIG.music;
      if (!m || !m.enabled) return;

      musicControl.style.display = "flex";

      if (m.type === "youtube" && m.youtubeId){
        const iframe = document.createElement("iframe");
        iframe.width = "0";
        iframe.height = "0";
        iframe.src = `https://www.youtube.com/embed/${encodeURIComponent(m.youtubeId)}?enablejsapi=1&loop=1&playlist=${encodeURIComponent(m.youtubeId)}`;
        iframe.allow = "autoplay";
        musicPlayer.appendChild(iframe);

        musicControl.addEventListener("click", ()=>{
          window.open(`https://www.youtube.com/watch?v=${m.youtubeId}`, '_blank');
        });
        musicLabel.textContent = "Open Music";
        
      } else if (m.type === "audio" && m.audioSrc){
        audioElement = document.createElement("audio");
        audioElement.src = m.audioSrc;
        audioElement.loop = true;
        audioElement.volume = m.volume || 0.3;
        musicPlayer.appendChild(audioElement);

        if (m.autoplay){
          const tryAutoplay = () => {
            audioElement.play().then(()=>{
              isPlaying = true;
              musicControl.classList.add("playing");
              musicIcon.textContent = "üîä";
              musicLabel.textContent = "Pause Music";
            }).catch(()=>{
              console.log("Autoplay blocked. Click anywhere to start music.");
              const startOnInteraction = () => {
                audioElement.play().then(()=>{
                  isPlaying = true;
                  musicControl.classList.add("playing");
                  musicIcon.textContent = "üîä";
                  musicLabel.textContent = "Pause Music";
                });
                document.removeEventListener("click", startOnInteraction);
                document.removeEventListener("touchstart", startOnInteraction);
              };
              document.addEventListener("click", startOnInteraction, { once: true });
              document.addEventListener("touchstart", startOnInteraction, { once: true });
            });
          };
          
          setTimeout(tryAutoplay, 100);
        }

        musicControl.addEventListener("click", (e)=>{
          e.stopPropagation();
          if (isPlaying){
            audioElement.pause();
            isPlaying = false;
            musicControl.classList.remove("playing");
            musicIcon.textContent = "üéµ";
            musicLabel.textContent = "Play Music";
          } else {
            audioElement.play();
            isPlaying = true;
            musicControl.classList.add("playing");
            musicIcon.textContent = "üîä";
            musicLabel.textContent = "Pause Music";
          }
        });
      }
    }

    initMusic();
  </script>
</body>
</html>
